{% extends 'layout.html' %}


{% block content %}

    <div class="panel panel-primary">
        <div class="panel-body">
            <h1>原料出库单</h1>
            <form class="form-group" method="post">
                {% csrf_token %}
                <table class="table table-bordered table-hover" id="table-excel">
                    <tr>
                        <td>科目</td>
                        <td colspan="5">创建时间：</td>
                        <td colspan="2">对方科目</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td colspan="2">
                            <input type="text" name="title" placeholder="产品名称" class="form-control"><span
                                style="color: red">{{ title_tips }}</span>
                        </td>
                        <td>单位</td>
                        <td>数量</td>
                        <td>单价</td>
                        <td>金额</td>
                        <td>备注</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_1" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_1" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_1" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_1" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_1" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_1' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_2" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_2" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_2" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_2" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_2" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_2' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_3" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_3" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_3" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_3" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_3" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_3' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_4" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_4" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_4" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_4" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_4" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_4' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_5" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_5" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_5" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_5" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_5" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_5' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_6" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_6" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_6" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_6" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_6" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_6' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_7" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_7" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_7" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_7" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_7" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_7' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <select name="cls_8" id="cls" class="form-control">
                                <option value selected>-------</option>
                                {% for cls in all_cls %}
                                    <option value="{{ cls.pk }}">{{ cls.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="mat_8" id="mat" class="form-control">
                                <option value selected>-------</option>
                            </select>
                        </td>
                        <td>KG</td>
                        <td>
                            <input type="text" class="form-control" name="amount_8" placeholder="商品数量">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="unit_price_8" placeholder="单价">
                        </td>
                        <td>
                            <input type="text" class="form-control" name="price_8" placeholder="金额">
                        </td>
                        <td>
                            <input type="text" class="form-control" name='remarks_8' placeholder="备注">
                        </td>
                    </tr>
                    <tr>
                        <td>主管</td>
                        <td>
                            <input type="text" class="form-control" name="master" placeholder="主管">
                        </td>
                        <td>
                            会计
                        </td>
                        <td>
                            <input type="text" class="form-control" name="accountant" placeholder="会计">
                        </td>
                        <td>
                            保管员
                        </td>
                        <td>
                            <input type="text" class="form-control" name="locker" placeholder="保管员">
                        </td>
                        <td>
                            经手人
                        </td>
                        <td>
                            <input type="text" class="form-control" name="handler" placeholder="经手人"><span
                                style="color: red">{{ handler_tips }}</span>
                        </td>
                    </tr>
                </table>
                <h5 style="color: red">{{ tips }}</h5>

                <button class="btn-sm btn-success pull-right" id="sure">确认</button>
            </form>

        </div>
    </div>

{% endblock %}

{% block js %}
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>

        var nb = null;
        $('#table-excel').on('change', 'tr td #cls', function () {
            {#alert(JSON.stringify($(this).parent().next().find('#mat')));#}
            alert(JSON.stringify($(this).val()));
            nb = $(this);
            $.ajax(
                {
                    'url': '/storage/return_detail/',
                    'type': 'POST',

                    'data': {
                        'cls_pk': nb.val(),
                        "csrfmiddlewaretoken": $("[name = 'csrfmiddlewaretoken']").val(),
                    },
                    success: function (data) {
                        console.log(data);
                        nb.parent().next().find('select').empty();
                        for (i = 0; i < data.length; i++) {
                            var option = document.createElement('option');
                            option.setAttribute('value', data[i].id);
                            option.innerText = data[i].name;
                            var this_mat = nb.parent().next().find('select');
                            this_mat.append($(option));
                        }


                    }
                }
            )
        });

    </script>

{% endblock %}